<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<title>Авторынок Пермь</title>
<style>
  :root{--bg:#0B0F14;--card:#11171F;--stroke:#1C2733;--fg:#E8F0FF;--muted:#8EA0B5;--accent:#22D3EE;--tap:rgba(255,255,255,.06);--bad:#ff4d6d}
  *{box-sizing:border-box;font-family:-apple-system,system-ui,Roboto}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg)}
  a,a:link,a:visited,a:hover,a:active{color:inherit!important;text-decoration:none!important}
  .item:link,.item:visited,.item:hover,.item:active{color:inherit!important;background:var(--card)!important}
  a:focus-visible{outline:2px solid var(--accent);outline-offset:3px;border-radius:12px}
  *{-webkit-tap-highlight-color:rgba(0,0,0,0)}

  header{display:flex;align-items:center;justify-content:center;padding:12px 16px;border-bottom:1px solid var(--stroke);
    background:rgba(13,18,25,.9);backdrop-filter:blur(8px);position:sticky;top:0;z-index:10;}
  header img{width:28px;height:28px;margin-right:10px;filter:drop-shadow(0 0 2px rgba(0,0,0,.4))}
  header .title{font-weight:800;font-size:18px;letter-spacing:.3px;}

  .wrap{padding:12px 12px calc(90px + env(safe-area-inset-bottom));max-width:820px;margin:0 auto}
  .list{display:flex;flex-direction:column;gap:10px}
  .item{display:flex;gap:10px;background:var(--card);border:1px solid var(--stroke);border-radius:14px;overflow:hidden;transition:.15s}
  .item:active{background:#141c26}
  .ph{width:128px;min-width:128px;height:88px;background:#0f141a url() center/cover no-repeat;position:relative;border-right:1px solid var(--stroke)}
  .cnt{flex:1;display:flex;flex-direction:column;padding:10px 10px 10px 0}
  .ttl{font-weight:700;line-height:1.25;margin-bottom:6px}
  .price{font-weight:800;font-size:15px}
  .meta{color:var(--muted);font-size:12px;margin-top:2px}
  .row{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
  .pill{border:1px solid var(--stroke);background:#0f141a;color:#d6e3f7;border-radius:9px;padding:6px 10px;font-size:13px}
  .pill.primary{background:var(--accent);border-color:transparent;color:#001018;font-weight:800}
  .badge{position:absolute;top:6px;left:6px;background:var(--accent);color:#001018;font-weight:800;font-size:11px;padding:3px 6px;border-radius:7px}
  .cam{position:absolute;right:6px;bottom:6px;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);font-size:11px;padding:3px 6px;border-radius:8px}
  .fav.on{outline:2px solid var(--accent)}
  .muted{color:var(--muted);font-size:13px;text-align:center;margin-top:24px}

  .tabbar{position:fixed;left:0;right:0;bottom:0;background:rgba(13,18,25,.9);backdrop-filter:blur(8px);
    border-top:1px solid var(--stroke);padding:8px 12px calc(8px + env(safe-area-inset-bottom));z-index:20}
  .tabs{max-width:820px;margin:0 auto;display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
  .tab{position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:10px 0;border-radius:12px;color:#cfe3ff}
  .tab:active{background:var(--tap)}
  .tab.active{color:#fff}
  .tab.active::after{content:"";position:absolute;bottom:6px;width:22px;height:3px;border-radius:2px;background:var(--accent)}
  .plus{transform:translateY(-18px)}
  .plus .fab{width:56px;height:56px;border-radius:16px;background:var(--accent);display:flex;align-items:center;justify-content:center;
    box-shadow:0 6px 24px rgba(34,211,238,.35);color:#001018;font-weight:900}
  .tab .badge{position:absolute;top:6px;right:22%;min-width:18px;height:18px;padding:0 4px;border-radius:9px;background:var(--bad);color:#fff;font-size:11px;font-weight:800;display:none;align-items:center;justify-content:center}
  .tab[data-count]:not([data-count="0"]) .badge{display:flex}

  .sheet{position:fixed;left:0;right:0;bottom:0;transform:translateY(100%);transition:transform .25s ease;z-index:30}
  .sheet.show{transform:translateY(0)}
  .sheet .inner{max-width:820px;margin:0 auto;background:rgba(13,18,25,.98);backdrop-filter:blur(10px);
    border:1px solid var(--stroke);border-bottom:none;border-top-left-radius:16px;border-top-right-radius:16px;padding:12px}
  .grab{width:44px;height:5px;border-radius:4px;background:#223041;margin:4px auto 10px}

  .srow{display:flex;gap:8px;align-items:center}
  .search{flex:1;display:flex;align-items:center;gap:8px;background:#0f141a;border:1px solid var(--stroke);padding:10px 12px;border-radius:12px}
  .search input{flex:1;border:none;outline:none;background:transparent;color:#fff;font-size:15px}
  .chips{display:flex;gap:8px;overflow:auto;padding:10px 2px}
  .chip{white-space:nowrap;background:#0f141a;border:1px solid var(--stroke);color:#cfe3ff;border-radius:999px;padding:6px 12px;font-size:13px;cursor:pointer}
  .chip.on{background:#14202b;border-color:#2b3b4d;color:#fff}
  .smeta{color:var(--muted);font-size:12px;margin:6px 2px}
  .close{background:#14202b;border:1px solid #2b3b4d;color:#cfe3ff;border-radius:10px;padding:10px 12px;cursor:pointer}

  .form{display:flex;flex-direction:column;gap:10px}
  .row2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .inp{display:flex;flex-direction:column;gap:6px}
  .lab{color:var(--muted);font-size:12px}
  .ctl{background:#0f141a;border:1px solid var(--stroke);color:#fff;border-radius:12px;padding:10px 12px;font-size:15px}
  textarea.ctl{min-height:84px;resize:vertical}
  .pv{display:flex;gap:8px;overflow:auto;padding:2px 0}
  .thumb{position:relative;width:88px;height:64px;border-radius:10px;border:1px solid var(--stroke);background:#0f141a center/cover no-repeat}
  .x{position:absolute;top:-6px;right:-6px;width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;
    background:#1b2633;border:1px solid #2a3a4b;cursor:pointer}
  .primaryBtn{background:var(--accent);border:none;color:#001018;font-weight:800;padding:12px;border-radius:12px;font-size:16px}
  .ghostBtn{background:#14202b;border:1px solid #2b3b4d;color:#cfe3ff;border-radius:12px;padding:12px}
  .rowBtns{display:flex;gap:8px}
  .hint{color:var(--muted);font-size:12px;margin-top:-4px}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:calc(90px + env(safe-area-inset-bottom));background:#12202b;border:1px solid #1f3347;
    color:#dff3ff;padding:10px 14px;border-radius:12px;font-size:13px;opacity:0;pointer-events:none;transition:opacity .2s}
  .toast.show{opacity:1}

  /* inline-ошибки */
  .ctl.invalid{border-color:var(--bad)!important;box-shadow:0 0 0 3px rgba(255,77,109,.12)}
  .err{color:var(--bad);font-size:12px;margin-top:4px}
  .shake{animation:shake .28s linear 1}
  @keyframes shake{
    0%{transform:translateX(0)}20%{transform:translateX(-3px)}40%{transform:translateX(3px)}
    60%{transform:translateX(-2px)}80%{transform:translateX(2px)}100%{transform:translateX(0)}
  }
  @media (min-width:700px){.ph{width:180px;min-width:180px;height:120px}}

  /* --- Контурные иконки таббара --- */
  .tabbar .tab svg{
    width:26px;height:26px;
    stroke:currentColor;
    fill:none;
    stroke-width:2;
    stroke-linecap:round;
    stroke-linejoin:round;
    opacity:.9;
    display:block;
  }
  .tabbar .tab.active svg{opacity:1}
  .tabbar .plus .fab svg{
    stroke:#001018;
    fill:none;
    stroke-width:2;
  }
</style>

<header>
  <img src="/uploads/logo_nb3000.png" alt="Логотип">
  <div class="title">Авторынок&nbsp;Пермь</div>
</header>

<div class="wrap">
  <div id="feed" class="list"></div>
  <div id="empty" class="muted" style="display:none">Нет объявлений</div>
</div>

<!-- SEARCH SHEET -->
<div id="searchSheet" class="sheet" aria-hidden="true">
  <div class="inner">
    <div class="grab"></div>
    <div class="srow">
      <div class="search">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="#8EA0B5"><path d="M10 4a6 6 0 104.47 10.03l4.25 4.25 1.41-1.41-4.25-4.25A6 6 0 0010 4z"/></svg>
        <input id="q" placeholder="Марка, модель, район…" autocomplete="off">
        <button id="clearBtn" class="close" title="Очистить" style="display:none">Сброс</button>
      </div>
      <button id="closeSearch" class="close">Закрыть</button>
    </div>
    <div id="brandChips" class="chips"></div>
    <div id="resMeta" class="smeta">Найдено: 0</div>
  </div>
</div>

<!-- ADD SHEET -->
<div id="addSheet" class="sheet" aria-hidden="true">
  <div class="inner">
    <div class="grab"></div>

    <form class="form" id="addForm" accept-charset="utf-8">
      <div class="row2">
        <div class="inp"><div class="lab">Марка</div><input id="f_brand" name="brand" class="ctl" placeholder="Lada / Toyota / BMW" autocomplete="off"></div>
        <div class="inp"><div class="lab">Модель</div><input id="f_model" name="model" class="ctl" placeholder="Granta / Camry / 320i" autocomplete="off"></div>
      </div>
      <div class="row2">
        <div class="inp"><div class="lab">Год</div><input id="f_year" name="year" class="ctl" type="number" min="1950" max="2100" inputmode="numeric"></div>
        <div class="inp"><div class="lab">Цена, ₽</div><input id="f_price" name="price_rub" class="ctl" type="number" min="0" inputmode="numeric" placeholder="например 750000"></div>
      </div>
      <div class="inp"><div class="lab">Район</div><input id="f_district" name="district" class="ctl" placeholder="Пермь, Свердловский"></div>
      <div class="inp"><div class="lab">Описание</div><textarea id="f_desc" name="desc" class="ctl" placeholder="Коротко про авто (состояние, комплектация)"></textarea></div>

      <div class="inp">
        <div class="lab">Фото (до 10)</div>
        <input id="f_files" class="ctl" type="file" accept="image/*" multiple capture="environment">
        <div id="pv" class="pv"></div>
        <div class="hint">Первое фото станет обложкой. Можно удалять миниатюры перед отправкой.</div>
      </div>

      <div class="rowBtns">
        <button id="btnCancelAdd" class="ghostBtn" type="button">Отмена</button>
        <button id="btnSubmitAdd" class="primaryBtn" type="submit">Отправить</button>
      </div>
      <div id="addNote" class="hint"></div>
    </form>
  </div>
</div>
<div id="toast" class="toast">Готово</div>

<!-- bottom nav -->
<nav class="tabbar" aria-label="Нижняя навигация">
  <div class="tabs">
    <a class="tab" id="tabHome" href="/webapp/" aria-label="Главная" aria-current="page">
      <!-- home -->
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M3 10.5L12 3l9 7.5"/>
        <path d="M5 21V10.8L12 6l7 4.8V21"/>
        <path d="M9 21v-6h6v6"/>
      </svg>
    </a>

    <a class="tab" id="tabSearch" href="javascript:void(0)" aria-label="Поиск" aria-expanded="false">
      <!-- search -->
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <circle cx="11" cy="11" r="7"/>
        <path d="M21 21l-4.3-4.3"/>
      </svg>
    </a>

    <a class="tab plus" id="tabAdd" href="javascript:void(0)" aria-label="Добавить">
      <div class="fab">
        <!-- plus -->
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 5v14M5 12h14"/>
        </svg>
      </div>
    </a>

    <a class="tab" id="tabFav" href="javascript:void(0)" aria-label="Избранное" data-count="0">
      <span class="badge" id="favBadge">0</span>
      <!-- heart -->
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/>
      </svg>
    </a>

    <a class="tab" id="tabProfile" href="/webapp/profile" aria-label="Профиль">
      <!-- user -->
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <circle cx="12" cy="8" r="4"/>
        <path d="M6 20c0-3.3 2.7-6 6-6s6 2.7 6 6"/>
      </svg>
    </a>
  </div>
</nav>

<script src="/static/js/utils.js?v=1" defer></script>
<script src="/static/js/feed.js?v=1" defer></script>
<script src="/static/js/search.js?v=1" defer></script>
<script src="/static/js/add.js?v=1" defer></script>
<script src="/static/js/auth.js?v=1" defer></script>