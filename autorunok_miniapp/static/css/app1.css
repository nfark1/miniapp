:root{
  --bg:#0B0F14; --card:#11171F; --stroke:#1C2733; --fg:#E8F0FF; --muted:#8EA0B5; --accent:#22D3EE; --tap:rgba(255,255,255,.06); --bad:#ff4d6d;
  --tabbar-h: 72px;
  --sheet-gap: 12px; /* расстояние над таббаром */
}

*{box-sizing:border-box;font-family:-apple-system,system-ui,Roboto}
html,body{height:100%;margin:0;background:var(--bg);color:var(--fg)}
a,a:link,a:visited,a:hover,a:active{color:inherit!important;text-decoration:none!important}
.item:link,.item:visited,.item:hover,.item:active{color:inherit!important;background:var(--card)!important}
a:focus-visible{outline:2px solid var(--accent);outline-offset:3px;border-radius:12px}
*{-webkit-tap-highlight-color:rgba(0,0,0,0)}

header{
  display:flex;align-items:center;justify-content:center;
  padding:12px 16px;border-bottom:1px solid var(--stroke);
  background:rgba(13,18,25,.9);backdrop-filter:blur(8px);
  position:sticky;top:0;z-index:10;
}
header img{width:28px;height:28px;margin-right:10px;filter:drop-shadow(0 0 2px rgba(0,0,0,.4))}
header .title{font-weight:800;font-size:18px;letter-spacing:.3px;}

.wrap{
  padding:12px 12px calc(var(--tabbar-h) + env(safe-area-inset-bottom));
  max-width:820px;margin:0 auto;
}

.list{display:flex;flex-direction:column;gap:10px}
.item{display:flex;gap:10px;background:var(--card);border:1px solid var(--stroke);border-radius:14px;overflow:hidden;transition:.15s}
.item:active{background:#141c26}
.ph{width:128px;min-width:128px;height:88px;background:#0f141a url() center/cover no-repeat;position:relative;border-right:1px solid var(--stroke)}
.cnt{flex:1;display:flex;flex-direction:column;padding:10px 10px 10px 0}
.ttl{font-weight:700;line-height:1.25;margin-bottom:6px}
.price{font-weight:800;font-size:15px}
.meta{color:var(--muted);font-size:12px;margin-top:2px}
.row{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
.pill{border:1px solid var(--stroke);background:#0f141a;color:#d6e3f7;border-radius:9px;padding:6px 10px;font-size:13px}
.pill.primary{background:var(--accent);border-color:transparent;color:#001018;font-weight:800}
.badge{position:absolute;top:6px;left:6px;background:var(--accent);color:#001018;font-weight:800;font-size:11px;padding:3px 6px;border-radius:7px}
.cam{position:absolute;right:6px;bottom:6px;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);font-size:11px;padding:3px 6px;border-radius:8px}
.fav.on{outline:2px solid var(--accent)}
.muted{color:var(--muted);font-size:13px;text-align:center;margin-top:24px}

/* Кнопка избранного на карточке */
.fav-btn{
  position:absolute; top:6px; right:6px;
  width:32px; height:32px; border-radius:10px;
  display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,.38); border:1px solid rgba(255,255,255,.1);
  cursor:pointer; transition:transform .08s ease, background .2s ease;
}
.fav-btn:hover{ background:rgba(0,0,0,.52); }
.fav-btn:active{ transform:scale(.96); }
.fav-btn svg{ fill:currentColor; color:#cfe3ff; opacity:.9; }
.fav-btn.on{ background:rgba(34,211,238,.18); border-color:rgba(34,211,238,.5); }
.fav-btn.on svg{ color:#22D3EE; opacity:1; }

/* === Нижнее меню (tabbar) — компактнее и с опущенным плюсом === */
.tabbar {
  position: fixed;
  left: 0; right: 0; bottom: 0;
  background: rgba(13,18,25,0.9);
  backdrop-filter: blur(10px);
  border-top: 1px solid var(--stroke);
  padding: 6px 10px calc(6px + env(safe-area-inset-bottom));
  z-index: 50;
  min-height: 58px; /* ниже */
}

.tabs {
  max-width: 820px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 6px;
  align-items: center;
}

.tab {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  padding: 8px 0;
  border-radius: 12px;
  color: #cfe3ff;
  transition: background .15s ease, color .15s ease;
}
.tab:active { background: var(--tap); }
.tab.active { color: #fff; }
.tab.active::after {
  content: "";
  position: absolute;
  bottom: 4px;
  width: 22px; height: 3px;
  border-radius: 2px;
  background: var(--accent);
}

/* === Центральная кнопка (+) — без “разлетающейся” тени === */
.plus {
  transform: translateY(-10px); /* слегка приподнята */
}

.plus .fab {
  width: 58px;
  height: 58px;
  border-radius: 18px;
  background: var(--accent);
  display: flex;
  align-items: center;
  justify-content: center;
  color: #001018;
  font-weight: 900;
  box-shadow: 0 2px 10px rgba(34, 211, 238, 0.25);
  transition: transform 0.15s ease, box-shadow 0.2s ease;
}

/* при нажатии — немного “вжимается”, без расширенной тени */
.tab.plus:active .fab {
  transform: translateY(3px);
  box-shadow: 0 1px 4px rgba(34, 211, 238, 0.15);
}

/* при фокусе — лёгкое свечение */
.tab.plus:focus-visible .fab {
  box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.35);
}

/* иконка внутри */
.plus .fab svg {
  stroke: #001018;
  fill: none;
  stroke-width: 2;
}
/* чтобы клик шёл на весь таб, а не на svg */
.tab.plus .fab, .tab.plus .fab * { pointer-events:none; }

.tab .badge{
  position:absolute;top:6px;right:22%;
  min-width:18px;height:18px;padding:0 4px;border-radius:9px;
  background:var(--bad);color:#fff;font-size:11px;font-weight:800;
  display:none;align-items:center;justify-content:center
}
.tab[data-count]:not([data-count="0"]) .badge{display:flex}

/* Шиты (bottom sheets) — под таббаром, но над контентом */
.sheet{
  position:fixed; left:0; right:0;
  bottom:calc(var(--tabbar-h) + env(safe-area-inset-bottom) + 12px);
  transform:translateY(100%);
  transition:transform .25s ease;
  z-index:20;
  pointer-events:none;           /* спрятан — клики проходят сквозь */
  will-change: transform;
}
.sheet.show{
  transform:translateY(0);
  pointer-events:auto;           /* показан — клики активны */
}
.sheet.dragging { transition:none; } /* во время жеста — без анимации */

.sheet .inner{
  max-width:820px; margin:0 auto;
  background:rgba(13,18,25,.98);
  backdrop-filter:blur(10px);
  border:1px solid var(--stroke);
  border-bottom:none;
  border-top-left-radius:16px; border-top-right-radius:16px;
  padding:12px;
  overflow-y:auto;
  max-height: calc(100dvh - (var(--tabbar-h) + env(safe-area-inset-bottom)) - 30px);
  -webkit-overflow-scrolling: touch;
  overscroll-behavior-y: contain; /* чтобы не прокручивался фон */
}

/* Граббер */
.grab{
  width:52px; height:6px; border-radius:4px;
  background:#223041; margin:8px auto 12px;
  touch-action:none; cursor:grab;
}

/* Когда шит открыт — фон не скроллится */
.sheet-open body { overflow:hidden; }

.srow{display:flex;gap:8px;align-items:center}
.search{flex:1;display:flex;align-items:center;gap:8px;background:#0f141a;border:1px solid var(--stroke);padding:10px 12px;border-radius:12px}
.search input{flex:1;border:none;outline:none;background:transparent;color:#fff;font-size:15px}
.chips{display:flex;gap:8px;overflow:auto;padding:10px 2px}
.chip{white-space:nowrap;background:#0f141a;border:1px solid var(--stroke);color:#cfe3ff;border-radius:999px;padding:6px 12px;font-size:13px;cursor:pointer}
.chip.on{background:#14202b;border-color:#2b3b4d;color:#fff}
.smeta{color:var(--muted);font-size:12px;margin:6px 2px}
.close{background:#14202b;border:1px solid #2b3b4d;color:#cfe3ff;border-radius:10px;padding:10px 12px;cursor:pointer}

.form{display:flex;flex-direction:column;gap:10px}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.inp{display:flex;flex-direction:column;gap:6px}
.lab{color:var(--muted);font-size:12px}
/* --- автоподсказки под инпутами --- */
.inp { position: relative; } /* нужно для абсолютного позиционирования выпадашки */

.suggest {
  position: absolute;
  left: 0; right: 0;
  top: 100%;
  margin-top: 6px;
  background: #0f141a;
  border: 1px solid var(--stroke);
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,.35);
  max-height: 220px;
  overflow: auto;
  z-index: 60; /* выше .sheet */
}
.suggest.hidden { display: none; }

.suggest-item {
  padding: 10px 12px;
  font-size: 14px;
  color: #d6e3f7;
  cursor: pointer;
}
.suggest-item:hover,
.suggest-item.active {
  background: #14202b;
  color: #fff;
}

/* отключённое поле модели до выбора марки */
.ctl:disabled {
  opacity: .6;
  cursor: not-allowed;
}
.ctl{background:#0f141a;border:1px solid var(--stroke);color:#fff;border-radius:12px;padding:10px 12px;font-size:15px}
textarea.ctl{min-height:84px;resize:vertical}
.pv{display:flex;gap:8px;overflow:auto;padding:2px 0}
.thumb{position:relative;width:88px;height:64px;border-radius:10px;border:1px solid var(--stroke);background:#0f141a center/cover no-repeat}
.x{position:absolute;top:-6px;right:-6px;width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#1b2633;border:1px solid #2a3a4b;cursor:pointer}

.primaryBtn{background:var(--accent);border:none;color:#001018;font-weight:800;padding:12px;border-radius:12px;font-size:16px}
.ghostBtn{background:#14202b;border:1px solid #2b3b4d;color:#cfe3ff;border-radius:12px;padding:12px}
.rowBtns{display:flex;gap:8px}
.hint{color:var(--muted);font-size:12px;margin-top:-4px}

/* Toast */
.toast{
  position:fixed; left:50%; transform:translateX(-50%);
  bottom:calc(var(--tabbar-h) + env(safe-area-inset-bottom));
  background:#12202b; border:1px solid #1f3347;
  color:#dff3ff; padding:10px 14px; border-radius:12px;
  font-size:13px; opacity:0; pointer-events:none; transition:opacity .2s;
}
.toast.show{ opacity:1; }

/* Ошибки */
.ctl.invalid{border-color:var(--bad)!important;box-shadow:0 0 0 3px rgba(255,77,109,.12)}
.err{color:var(--bad);font-size:12px;margin-top:4px}
.shake{animation:shake .28s linear 1}
@keyframes shake{
  0%{transform:translateX(0)}20%{transform:translateX(-3px)}40%{transform:translateX(3px)}
  60%{transform:translateX(-2px)}80%{transform:translateX(2px)}100%{transform:translateX(0)}
}

/* Контурные иконки таббара */
.tabbar .tab svg{
  width:26px;height:26px;
  stroke:currentColor; fill:none; stroke-width:2;
  stroke-linecap:round; stroke-linejoin:round; opacity:.9; display:block;
}
.tabbar .tab.active svg{opacity:1}
.plus .fab svg{stroke:#001018; fill:none; stroke-width:2}

.sheet {
  bottom: calc(var(--tabbar-h) + env(safe-area-inset-bottom));
}

.tabbar {
  box-shadow: 0 -2px 10px rgba(0,0,0,.4);
  border-top: none;
}

body::after {
  content: "";
  position: fixed;
  left: 0;
  right: 0;
  bottom: var(--tabbar-h);
  height: 2px;
  background: var(--bg);
  z-index: 49; /* чуть ниже tabbar */
}

/* === Telegram Mini App — мобильная оптимизация === */

/* безопасная зона (нижняя панель Телеги, вырез камеры и т.д.) */
body {
  padding-bottom: env(safe-area-inset-bottom);
}

/* уменьшить высоту таббара для телефонов */
@media (max-width: 600px) {
  :root {
    --tabbar-h: 62px;
  }

  .tabbar {
    padding: 6px 10px calc(6px + env(safe-area-inset-bottom));
  }

  .tab svg {
    width: 24px;
    height: 24px;
  }

  .plus .fab {
    width: 52px;
    height: 52px;
    border-radius: 14px;
    box-shadow: 0 4px 16px rgba(34,211,238,.25);
  }

  .tab .badge {
    top: 4px;
    right: 18%;
  }
}

/* убрать серую подсветку при тапе (iOS Safari) */
* {
  -webkit-tap-highlight-color: rgba(0,0,0,0);
}

/* для тёмного режима Telegram */
@media (prefers-color-scheme: dark) {
  body {
    background: var(--bg);
    color: var(--fg);
  }
}
.sheet .inner {
  /* всё, что уже есть... */
  padding-bottom: calc(var(--tabbar-h) + env(safe-area-inset-bottom) + 16px);
}

/* FIX: поля в .row2 не должны разъезжаться вправо */
.row2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}
.row2 .inp { 
  min-width: 0;            /* важно: разрешаем сжиматься во 2 колонке */
}
.row2 .ctl {
  display: block;          /* было flex — убираем */
  width: 100%;
  box-sizing: border-box;
  height: 44px;
  padding: 10px 12px;
  line-height: 1.2;
  overflow: hidden;        /* на всякий */
}

/* на узких экранах стекаем в одну колонку, чтобы точно не упиралось */
@media (max-width: 420px) {
  .row2 { grid-template-columns: 1fr; }
}
/* Подсказки под инпутом */
.inp { position: relative; }
.suggest {
  position: absolute; left: 0; right: 0; top: calc(100% + 6px);
  background: #0f141a; border: 1px solid var(--stroke);
  border-radius: 12px; max-height: 220px; overflow: auto; z-index: 60;
  box-shadow: 0 8px 24px rgba(0,0,0,.35);
}
.suggest.hidden { display: none; }
.suggest-item { padding: 10px 12px; font-size: 14px; color: #d6e3f7; cursor: pointer; }
.suggest-item:hover, .suggest-item.active { background: #14202b; color: #fff; }

/* гарантируем, что крестик кликается поверх всего */
.thumb { position: relative; }
.x { z-index: 5; pointer-events: auto; }
.pv, .thumb { pointer-events: auto; }
/* Крестик на превью */
.pv .x{
  color:#cfe3ff;           /* цвет символа */
  font-weight:800;
  font-size:12px;
  line-height:1;
}
/* Кастомная кнопка выбора фото */
.fileBtn{
  display:inline-flex; align-items:center; gap:8px;
  padding:10px 14px;
  border-radius:12px;
  background:var(--accent);
  color:#001018; font-weight:800; font-size:14px;
  box-shadow:0 0 18px rgba(34,211,238,.35);
  cursor:pointer; user-select:none;
  transition:transform .12s ease, box-shadow .2s ease, filter .2s ease;
}
.fileBtn:hover{ filter:brightness(1.05); }
.fileBtn:active{ transform:translateY(1px); box-shadow:0 0 10px rgba(34,211,238,.25); }

/* Нативный input перекрывает всю кнопку, невидимый (чтобы iOS не показывал "6 фото") */
.fileBtn input[type="file"]{
  position:absolute; inset:0; width:100%; height:100%;
  opacity:0; cursor:pointer;
}

/* Сетка превью уже есть у тебя (.pv / .thumb), на всякий случай оставлю компакт */
.pv{ display:flex; gap:8px; flex-wrap:wrap; padding:6px 0; }
.thumb{ width:72px; height:72px; border-radius:10px; background:#0f141a center/cover no-repeat; position:relative; border:1px solid var(--stroke); }
.thumb .x{
  position:absolute; top:-6px; right:-6px; width:22px; height:22px;
  border-radius:50%; display:flex; align-items:center; justify-content:center;
  background:#1b2633; border:1px solid #2a3a4b; color:#fff; line-height:1; font-size:14px;
  pointer-events:auto; cursor:pointer;
}

/* — переупорядочивание превью — */
.pv{ display:flex; gap:8px; overflow-x:auto; padding:2px 0 }
.thumb{ position:relative; width:88px; height:64px; border-radius:10px;
        border:1px solid var(--stroke); background:#0f141a center/cover no-repeat;
        flex:0 0 auto; user-select:none; touch-action:none; }
.thumb.dragging{ opacity:.6; transform:scale(.96); z-index:2 }
.thumb.placeholder{ border:2px dashed var(--accent); background:transparent }

/* Блок фото: небольшой зазор между кнопкой выбора и превью */
#addSheet .inp.photos .uploadBox { margin-bottom: 10px; } /* если есть uploadBox */
#addSheet #pv { margin-top: 8px; }                         /* опустить превью на пару пикселей */

/* Чтобы крестик не обрезался */
#addSheet .pv { overflow: visible; }
#addSheet .pv .thumb { position: relative; overflow: visible; }
#addSheet .pv .thumb .x {
  position: absolute;
  top: -6px;                 /* приподнимем наружу */
  right: -6px;
  width: 24px;
  height: 24px;
  line-height: 24px;
  border-radius: 50%;
  z-index: 5;                /* поверх всего */
  /* по желанию: легкая тень для читаемости */
  box-shadow: 0 2px 6px rgba(0,0,0,.25);
}